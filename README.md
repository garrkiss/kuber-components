# Домашнее задание к занятию "`Компоненты Kubernetes`" - `Бакулев Евгений`

## Задание. Необходимо определить требуемые ресурсы

## Расчёт ресурсов

### 1. Расчёт необходимых ресурсов

**База данных**:

- 3 копии × (4 ГБ ОЗУ, 1 ядро) = **12 ГБ ОЗУ**, **3 ядра**.

**Кеш**:

- 3 копии × (4 ГБ ОЗУ, 1 ядро) = **12 ГБ ОЗУ**, **3 ядра**.

**Фронтенд**:

- 5 копий × (50 МБ ОЗУ, 0.2 ядра) = **250 МБ ОЗУ** (\~0.25 ГБ), **1 ядро**.

**Бэкенд**:

- 10 копий × (600 МБ ОЗУ, 1 ядро) = **6000 МБ ОЗУ** (\~6 ГБ), **10 ядер**.

**Общие ресурсы**:

- ОЗУ: 12 + 12 + 0.25 + 6 = **30.25 ГБ**.
- Ядра: 3 + 3 + 1 + 10 = **17 ядер**.

### 2. Учёт служебных ресурсов

Согласно рекомендациям из статей:

- Служебные процессы (kubelet, container runtime) требуют \~1 ГБ ОЗУ и \~0.5 ядра на ноду.
- Резерв для системных нужд: \~10–20% ресурсов.

Добавляем на каждую ноду:

- **1 ГБ ОЗУ**, **0.5 ядра** для служебных процессов.

### 3. Расчёт количества нод

**Выбор размера нод**:

- Средние ноды (8 ядер, 32 ГБ ОЗУ) оптимальны для баланса отказоустойчивости и эффективности (learnk8s.io).
- Используем ноды: **8 ядер**, **32 ГБ ОЗУ** (например, `t3.2xlarge` в AWS).

**Полезные ресурсы на ноду**:

- ОЗУ: 32 ГБ – 1 ГБ = **31 ГБ**.
- Ядра: 8 – 0.5 = **7.5 ядер**.

**Минимальное количество нод**:

- ОЗУ: 30.25 ГБ / 31 ГБ ≈ **1 нода**.
- Ядра: 17 ядер / 7.5 ядер ≈ **2.27 ноды** → округляем до **3 нод**.

### 4. Учёт отказоустойчивости

Кластер должен выдерживать выход из строя **1 ноды**.

- При 3 нодах, потеря одной оставляет:
  - ОЗУ: 2 × 31 ГБ = **62 ГБ** (&gt; 30.25 ГБ — достаточно).
  - Ядра: 2 × 7.5 = **15 ядер** (&lt; 17 ядер — недостаточно).

Для покрытия 17 ядер при потере 1 ноды:

- Ядра: 17 / 7.5 ≈ 2.27 → нужно **4 ноды**.
- При 4 нодах, потеря одной оставляет:
  - ОЗУ: 3 × 31 ГБ = **93 ГБ** (&gt; 30.25 ГБ).
  - Ядра: 3 × 7.5 = **22.5 ядра** (&gt; 17 ядер).

**Итог**: **4 ноды** (8 ядер, 32 ГБ ОЗУ каждая).

### 5. Проверка запаса

При 4 нодах:

- Полезные ресурсы: 4 × 31 ГБ = **124 ГБ ОЗУ**, 4 × 7.5 = **30 ядер**.
- Запас:
  - ОЗУ: 124 / 30.25 ≈ **4x**.
  - Ядра: 30 / 17 ≈ **1.76x**.
- При потере 1 ноды: **93 ГБ**, **22.5 ядра** — достаточно.

### 6. Рекомендации

- **Helm-чарт**:
  - Разделите окружения (dev, staging, prod) через `values.yaml`.
  - Настройте ресурсы:
    - База данных: `requests: { memory: "4Gi", cpu: "1" }, limits: { memory: "4.5Gi", cpu: "1.2" }`.
    - Кеш: аналогично.
    - Фронтенд: `requests: { memory: "50Mi", cpu: "200m" }, limits: { memory: "100Mi", cpu: "300m" }`.
    - Бэкенд: `requests: { memory: "600Mi", cpu: "1" }, limits: { memory: "800Mi", cpu: "1.2" }`.
  - Используйте `affinity/anti-affinity` для распределения копий по нодам.
  - Настройте HPA (Horizontal Pod Autoscaler) для фронтенда и бэкенда.
- **Хранение**:
  - База данных: \~50 ГБ SSD на копию (итого 150 ГБ для 3 копий).
  - Кеш: аналогично, если требуется постоянное хранилище.
  - Рекомендуется \~200 ГБ SSD на ноду для Persistent Volumes.
- **Масштабируемость**:
  - Используйте Cluster Autoscaler для автоматического добавления нод.
  - Избегайте слишком крупных нод для минимизации влияния сбоев (kubernetes.io).

## Итоговый результат

- **Количество нод**: **4**.
- **Параметры ноды**: **8 ядер**, **32 ГБ ОЗУ**, **\~200 ГБ SSD**.
- **Общие ресурсы кластера**:
  - ОЗУ: 128 ГБ (полезно \~124 ГБ).
  - Ядра: 32 ядра (полезно \~30 ядер).
  - Запас: \~1.76x по ядрам, \~4x по ОЗУ; при потере 1 ноды — достаточно ресурсов.


